# Deadlock
두개 이상의 프로세스 혹은 스레드들이 서로가 가진 자원을 기다리며 block된 상태입니다.

## 발생 조건
이 4가지 조건이 다 성립해야 데드락에 걸립니다.
### 상호 배제(Mutual Exclusion)
- 매 순간 하나의 프로세스만이 자원을 사용할 수 있음
- 자원 공유 X
### 비선점(Non Preemption)
- 프로세스는 자원을 스스로 내어놓을뿐 강제로 빼앗기지 않음
### 점유 대기(Hold and wait)
- 자원을 가진 프로세스가 다른 자원을 기다릴때 보유 자원을 놓지 않고 계속 가지고 있음
### 순환 대기(Circular wait)
- 자원을 기다리는 프로세스 간 사이클이 형성되어야 함
## 처리 방법
### 예방
4가지 필요 조건 중 어느 하나가 만족되지 않도록 하는 방법입니다.
- 상호배제
    - 읽기 전용 파일과 같은 공유 자원을 사용
- 비선점
    - 모든 자원에 대한 선점을 허용
    - 프로세스가 할당받을 수 없는 자원을 요청하는 경우, 가지고 있던 자원을 모두 반납하고 새 자원과 이전 자원을 얻기 위해서 대기(<b>자원 낭비 발생</b>)
- 점유 대기
    - 프로세스 대기를 없애기 위해서 프로세스가 실행되기 전에 필요한 모든 자원을 할당(<b>자원 낭비 발생</b>)
    - 자원을 점유하고 있지 않을때만 다른 자원을 요청할 수 있도록 함(<b>기아 상태 가능</b>)
- 순환 대기
    - 자원에 고유한 번호를 할당하고 번호 순서대로 자원을 요구하도록 함(<b>자원 낭비 발생</b>)
### 회피
교착상태 발생 전 교착상태를 예상하여 안전한 상태(safe state)에서만 자원 요청을 허용하는 방법

예상하기 위해서 다음과 같은 가정이 필요합니다.
- 프로세스 수가 고정되어 있어야 한다.
- 자원의 종류와 수가 고정되어 있어야 한다.
- 프로세스가 요구하는 자원 및 최대 자원 수를 알아야 한다.
- 프로세스는 반드시 자원 사용 후 반납해야 한다.

#### 교착상태를 회피하기 위한 알고리즘
- 은행원 알고리즘(Banker's Algorithm) (자원이 여러 종류일 때)
- 자원 할당 그래프 알고리즘(Resource-Allocation Graph Algorithm) (자원이 한 종류일 때)
### 탐지 & 회복
#### 탐지
특정 조건 하에서 시스템을 검사하여 교착상태의 존재 여부를 확인하는 과정입니다. 탐지 알고리즘은 자원 할당 그래프를 분석하여 교착상태를 확인할 수 있습니다. 이 그래프에서 교착상태는 순환 대기 조건을 만족하는 사이클로 나타납니다.
- 사이클 탐지
    - 그래프 내에서 사이클이 존재하는 경우, 시스템에 교착상태가 발생했음을 의미합니다. 모든 사이클이 교착상태를 의미하는 것은 아니며, 다중 인스턴스를 지원하는 경우에는 복잡한 분석이 필요함

#### 회복
교착상태를 탐지한 후에는 시스템을 다시 정상 상태로 복구해야합니다. 교착상태에서 회복하는 방법에는 여러 가지가 있으며, 주로 다음 두 가지 접근 방식을 사용합니다.
1. 프로세스 종료
    - 비용이 높은 방법일 수 있음
    - 작업의 손실이 발생할 수 있음
2. 자원 선점
    - 교착상태 해결을 위해 하나 이상의 프로세스로부터 자원을 강제로 회수
    - 선점된 자원은 다른 프로세스에 재할당되어 교착상태를 해결한다

교착상태 회복 방법을 선택할 때는 시스템의 특성, 프로세스의 중요도, 작업의 재실행 비용, 자원의 특성 등 여러 요소를 고려해야 합니다. 또한, 교착상태 회복 작업은 시스템의 성능에 영향을 줄 수 있으므로, 교착상태 탐지 주기와 회목 메커니즘을 적절히 설계하여야 합니다.
